<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Guia — Vamos Escalar Juntos</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=Poppins:wght@700;800&display=swap" rel="stylesheet">
  <meta name="theme-color" content="#0B0C10">

  <style>
    :root{
      --bg:#0B0C10; --text:#ffffff; --muted:rgba(214,218,229,.85);
      --surface:rgba(255,255,255,.04); --border:rgba(255,255,255,.12);
      --purple:#7269E3; --purple-strong:#625BD6; --mint:#98DEA3; --mauve:#A783A6;
      --shadow:0 10px 30px rgba(0,0,0,.35); --header-h:64px;
      --font-heading:'Poppins', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      --font-body:'Inter', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font:400 16px/1.6 var(--font-body);
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
      padding-top:calc(var(--header-h) - 10px);
      -webkit-tap-highlight-color: transparent;
    }
    a{color:inherit; text-decoration:none}
    img{max-width:100%; height:auto; display:block}
    .container{width:100%; max-width:1120px; margin:0 auto; padding:0 20px}

    /* HEADER centralizado */
    .site-header{
      position:fixed; inset:0 0 auto 0; z-index:1000;
      background:rgba(11,12,16,.6);
      backdrop-filter:saturate(140%) blur(8px);
      -webkit-backdrop-filter:saturate(140%) blur(8px);
      display:flex; justify-content:center; align-items:center; height:var(--header-h);
    }
    .brand{display:inline-flex; align-items:center}
    .brand img{height:32px; width:auto}

    /* CARD/FORM */
    .card{border:1px solid var(--border); border-radius:20px; box-shadow:var(--shadow);
      padding:28px; max-width:860px; margin:40px auto; background:none}
    .title{font-family:var(--font-heading); font-weight:800; font-size:28px; margin:0 0 6px;
      text-align:center; color:var(--mint)}
    .subtitle{margin:0 0 20px; text-align:center; color:var(--muted)}
    .grid{display:grid; gap:14px}
    .grid-2{grid-template-columns:1fr 1fr}
    @media(max-width:720px){.grid-2{grid-template-columns:1fr}}
    .field{display:grid; gap:8px}
    .input, textarea{background:rgba(255,255,255,.05); border:1px solid var(--border);
      border-radius:12px; padding:12px 14px; font-size:14px; color:var(--text)}
    .input:focus, textarea:focus{outline:none; border-color:var(--purple);
      box-shadow:0 0 0 3px rgba(114,105,227,.25)}
    textarea{min-height:120px; resize:vertical; margin-top:6px}

    /* Checkboxes – mobile cheio */
    .choices{display:grid; gap:12px}
    .choice{
      width:100%;
      display:flex; align-items:center; gap:14px;
      padding:16px 18px;
      border:1px solid var(--border);
      border-radius:16px;
      background:var(--surface);
      cursor:pointer; transition:border-color .15s, background .15s;
      touch-action:manipulation;
    }
    .choice:hover{border-color:#7f86ff44}
    .choice .label{line-height:1.35; user-select:none; flex:1}
    .choice input{
      -webkit-appearance:none; appearance:none;
      position:relative;
      width:24px; height:24px; flex:0 0 24px;
      border:2px solid var(--border);
      border-radius:6px; background:transparent;
      outline:none; transition:border-color .15s, background .15s;
    }
    .choice input::after{
      content:""; position:absolute; inset:3px;
      border-radius:4px; background:var(--purple);
      opacity:0; transform:scale(.9);
      transition:opacity .12s ease, transform .12s ease;
    }
    .choice input:checked{border-color:var(--purple); background:rgba(114,105,227,.12)}
    .choice input:checked::after{opacity:1; transform:scale(1)}
    @media (max-width:720px){
      .choice{padding:18px 20px; border-radius:18px}
      .choice input{width:26px; height:26px; flex-basis:26px}
      .choice input::after{inset:3px}
    }

    .btn{margin-top:16px; background:linear-gradient(180deg,var(--purple),var(--purple-strong));
      color:#fff; font-weight:700; border:none; border-radius:999px; padding:12px 18px;
      cursor:pointer; display:block; margin-left:auto; margin-right:auto}
    .btn[disabled]{opacity:.6; cursor:not-allowed}
    .spinner{display:inline-block; width:16px; height:16px; border:2px solid #fff; border-right-color:transparent;
      border-radius:50%; margin-left:8px; vertical-align:-3px; animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    #status{margin-top:12px; text-align:center; font-size:14px; color:var(--muted)}
    #status.ok{color:var(--mint)} #status.err{color:#ff7b7b}
    #otherField{display:none}
  </style>

  <!-- reCAPTCHA v3 com pré-token -->
  <script>
    const RECAPTCHA_SITE_KEY = "6LdeQ7UrAAAAAKFcbKoaZF_duTuabz7eddw8Tlf7";
    (function(){
      const s=document.createElement("script");
      s.src="https://www.google.com/recaptcha/api.js?render="+encodeURIComponent(RECAPTCHA_SITE_KEY);
      s.async=true; s.defer=true; document.head.appendChild(s);
    })();

    let cachedToken=null, tokenTs=0;
    const TOKEN_TTL_MS = 90*1000;
    function refreshRecaptchaToken(action="submit"){
      return new Promise((resolve,reject)=>{
        if(!window.grecaptcha) return reject(new Error("reCAPTCHA não carregado"));
        grecaptcha.ready(()=>{
          grecaptcha.execute(RECAPTCHA_SITE_KEY,{action}).then(t=>{
            cachedToken=t; tokenTs=Date.now(); resolve(t);
          }).catch(reject);
        });
      });
    }
    function getRecaptchaTokenFast(action="submit"){
      const fresh = cachedToken && (Date.now()-tokenTs < TOKEN_TTL_MS);
      return fresh ? Promise.resolve(cachedToken) : refreshRecaptchaToken(action);
    }
    window.addEventListener('pointerdown', ()=>{ getRecaptchaTokenFast("prefetch").catch(()=>{}); }, {once:true});
  </script>
</head>
<body>

  <!-- HEADER -->
  <header class="site-header" aria-label="Cabeçalho da Guia (Agência)">
    <a href="#" class="brand" aria-label="Página inicial da Guia">
      <img src="LOGO.svg" alt="Logo Guia" decoding="async" loading="eager" />
    </a>
  </header>

  <!-- FORM -->
  <main>
    <form class="card" id="leadForm" autocomplete="on" novalidate>
      <h1 class="title">Vamos Escalar Juntos</h1>
      <p class="subtitle">Do primeiro contato à conversão: leve seu atendimento no WhatsApp para o próximo nível.</p>

      <div class="grid grid-2">
        <div class="field"><input class="input" name="firstName" placeholder="Nome" required></div>
        <div class="field"><input class="input" name="lastName" placeholder="Sobrenome" required></div>
        <div class="field"><input class="input" name="company" placeholder="Nome da empresa" required></div>
        <div class="field"><input class="input" name="segment" placeholder="Segmento de mercado"></div>
        <div class="field" style="grid-column:1/-1"><input type="tel" class="input" name="phone" placeholder="Telefone" required pattern="[0-9\\s()+-]{8,}"></div>
      </div>

      <h3 style="margin-top:6px">Com o que podemos ajudar?</h3>
      <div class="choices">
        <label class="choice"><input type="checkbox" name="help" value="Atendimento inicial automático"><span class="label">Atendimento inicial automático</span></label>
        <label class="choice"><input type="checkbox" name="help" value="Agendamento de horários"><span class="label">Agendamento de horários</span></label>
        <label class="choice"><input type="checkbox" name="help" value="Suporte ao cliente"><span class="label">Suporte ao cliente</span></label>
        <label class="choice"><input type="checkbox" name="help" value="Fluxos de atendimento personalizados"><span class="label">Fluxos de atendimento personalizados</span></label>
        <label class="choice"><input type="checkbox" name="help" value="Automação de venda"><span class="label">Automação de vendas</span></label>
        <label class="choice"><input type="checkbox" id="otherCheck" name="help" value="Outro"><span class="label">Outro</span></label>
      </div>

      <div class="field" id="otherField">
        <input class="input" type="text" id="otherText" name="otherDetail" placeholder="Descreva o Outro" disabled>
      </div>

      <div class="field">
        <label for="message">Detalhe do projeto</label>
        <textarea id="message" name="message" required placeholder="Dados, volume, cronograma e resultados esperados"></textarea>
      </div>

      <div class="field">
        <label><input type="checkbox" name="privacy" required> Eu concordo com a Política de Privacidade</label>
      </div>

      <!-- Honeypot -->
      <input type="text" name="website" autocomplete="off" tabindex="-1"
             style="position:absolute; left:-9999px; opacity:0" aria-hidden="true">

      <button class="btn" id="submitBtn" type="submit">Enviar
        <span id="spin" class="spinner" style="display:none"></span></button>
      <p id="status" aria-live="polite"></p>
    </form>
  </main>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="container footer-content">
      <small class="muted">© <span id="footer-year"></span> Guia — Todos os direitos reservados</small>
      <div class="footer-links">
        <a class="tag" href="https://www.instagram.com" target="_blank" rel="noopener" aria-label="Instagram">Instagram</a>
        <a class="tag" href="https://wa.me/5511999999999" target="_blank" rel="noopener" aria-label="WhatsApp">WhatsApp</a>
        <a class="tag" href="https://www.linkedin.com" target="_blank" rel="noopener" aria-label="LinkedIn">LinkedIn</a>
      </div>
    </div>
  </footer>

  <script>
    document.getElementById('footer-year').textContent = new Date().getFullYear();

    const otherCheck = document.getElementById('otherCheck');
    const otherField = document.getElementById('otherField');
    const otherText  = document.getElementById('otherText');
    otherCheck.addEventListener('change',()=>{
      const on = otherCheck.checked;
      otherField.style.display = on ? 'block' : 'none';
      otherText.disabled = !on;
      if(on) otherText.focus(); else otherText.value="";
    });

    const ENDPOINT = "https://script.google.com/macros/s/AKfycby4EAwhQIBI8h9GD7YK82lPohB1e5tgXg5qv8QP3JYap7e6iJutyV1wsKgs2P-QwrfDzA/exec";
    const form = document.getElementById('leadForm');
    const statusEl = document.getElementById('status');
    const submitBtn = document.getElementById('submitBtn');
    const spin = document.getElementById('spin');

    // Constrói os dados em URLSearchParams (compatível com sendBeacon)
    function buildParams(token){
      const fd = new FormData(form);
      const helps = fd.getAll('help');
      const otherDetail = (fd.get('otherDetail') || '').trim();
      const params = new URLSearchParams();

      params.append('firstName', fd.get('firstName') || '');
      params.append('lastName',  fd.get('lastName')  || '');
      params.append('company',   fd.get('company')   || '');
      params.append('segment',   fd.get('segment')   || '');
      params.append('phone',     fd.get('phone')     || '');

      if (helps.includes('Outro')){
        helps.forEach(h => {
          params.append('help', h === 'Outro' && otherDetail ? `Outro: ${otherDetail}` : h);
        });
      } else {
        helps.forEach(h => params.append('help', h));
      }

      params.append('message',   fd.get('message') || '');
      params.append('privacy',   fd.get('privacy') ? 'true' : '');
      params.append('source',    'site-vamos-escalar-juntos');
      params.append('userAgent', navigator.userAgent);
      params.append('page',      location.href);
      params.append('timestamp', new Date().toISOString());
      params.append('recaptchaToken', token);
      return params;
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (form.website && form.website.value) return;
      if (!form.checkValidity()) { form.reportValidity(); return; }

      statusEl.textContent = "Enviando...";
      statusEl.className = "";
      submitBtn.disabled = true;
      spin.style.display = "inline-block";

      try {
        // 1) Gera token (único passo “bloqueante”)
        const token = await getRecaptchaTokenFast("submit");

        // 2) Envia de forma instantânea (fire-and-forget)
        const params = buildParams(token);
        const sent = navigator.sendBeacon(ENDPOINT, params);

        // 3) Fallback MUITO curto (1.5s) apenas para quem bloqueia beacon
        if (!sent) {
          await Promise.race([
            fetch(ENDPOINT, { method:"POST", body: params, keepalive:true }),
            new Promise(res => setTimeout(res, 1500))
          ]);
        }

        // Feedback imediato ao usuário
        statusEl.className = "ok";
        statusEl.textContent = "Recebido! Vamos falar com você em breve.";
        form.reset(); otherField.style.display='none'; otherText.disabled=true;

      } catch (err) {
        console.error("Falha no envio:", err);
        statusEl.className = "err";
        statusEl.textContent = "Falha no envio: " + (err.message || "erro de rede");
      } finally {
        submitBtn.disabled = false;
        spin.style.display = "none";
      }
    });
  </script>
</body>
</html>
